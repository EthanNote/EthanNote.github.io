# WiFi 信号的发送与接收
## 从 0-1 数据到正弦电磁波信号
如果你还记得高中学过的三角函数 f(x) = A sin(ωx + t), 那么应该可以理解，函数曲线的形状由波形的幅度A，角频率ω，和初始相位t 共同决定。
如果我们使用某个参数构造一个正弦电磁波波形，让它从天线发射出去，在远处使用接收天线接收到这一个波形，并设法还原出来发送时的参数，那么我们就完成了一次通信——
发送和接收电磁波参数。
如果我们仅利用频率参数发送和接收信息，比如用较高频率的电磁波代表数字0，用频率较低的电磁波代表数字1，通过连续交替发送高频和低频数据，
我们就可以把二进制的0-1串发送出去了。把0、1这样的数字信号变为电磁波信号的过程称为调制，而另一头接收器把接收到的电磁波信号还原回 0、1的过程称为解调。
除了用不同的频率来调制数据，也可以用不同的相位，或者不同的幅度来调制信号。
用不同的频率来调制信号有一个专门的术语：调频（FM），收音机也是一种接收调频信号的设备，只不过被调制的数据不是二进制的0、1，而是声音。
也许你能猜出来调幅，调相这两个术语是什么意思了吧。
除了单纯地使用这三种调制方式，还可以同时混合使用其中的两种。也就是说，被发送出去的两个信号在频率不同的同时，还可以相位也不同。

## 什么是带宽？宽带的反义词吗？
如果使用了调频，就意味着电磁波的频率不是固定的，而是始终在改变。通常我们会设定一个变化范围，让电磁波的频率始终在这个范围里变化，这个范围的大小即带宽。
带宽的大小有什么意义呢？前面我们给出了使用两种不同频率分别调制 0 和 1 的例子，如果我们使用四种不同的频率，就可以一次调制四个不同的数字 0,1,2,3。
如果使用二进制表示，就等于分别能调制 00,01,10,11。本来需要分两次调制的信息，现在只需要调制一次就可以了，等于通信速度变为原来的两倍。
在固定带宽下，不同的调频频率越多越好吗？并不是，频率个数越多，相邻的两个频率大小就会越接近，导致接收机难以区分。就好比人眼能够很好地区分开黑色和白色，
但很难区分电脑屏幕所能够显示的 256 级灰度色彩中的各种不同的灰色。从另一个意义上讲，如果带宽越大，我们就可以使用的频率数量就越多，一次性能够传播的信息量就越大，
带宽的大小与一次性最多能发送的数据量有着一个确定的关系，信息论创始人香农首先发现并证明了这一关系的数学公式，称为香农容量公式。

C=B log2(1+S/N)

B 即带宽，S/N 是信号中有效数据成分的电磁波功率与干扰成分的功率的比值，简称信噪比，虽然电磁波不是声波，也习惯上把干扰信号称为噪声。

## 开车限制单双号，限制车道，乘坐公交车：这些都是复用技术
公路，即出发地和目的地各不相同的车辆都可以在同一条道路上经过。无线通信也是如此，在同一带宽中往返穿梭的电磁波信号可以来自不同的发射器，前往不同的接收器。在同一通道中传输不同路线的信号，这样的技术被称为信道多路复用，而重复的手段不止一种

- 时分复用 (Time Division Multiplexing, TDM)。在不同的时间段内允许不同的信号通过。例如现有发射器A、接收器B、C，A想要向B、C发送数据，它可以这么做：在第一秒时间内向B发送数据，第二秒向C发送数据，第三秒再向B发送数据。这样从大体来看，就好像A在同时向B、C发送数据。就跟限制单双号上路一样。

- 频分复用（Frequency Division Multiplexing，FDM）。将整个带宽切分成若干个小的带宽，各个小带宽上建立子信道，各个子信道可以进行互不干扰的通信。就好比将一条宽敞的公路划分为不同车道，各个车道的同行互不干扰。

- 码分复用（Code Division Multiplexing, CDM）。给每个通信数据包增加一个地址信息，就好比给一封信写上收件人地址，这样一个邮差就能给多个人送信，即同一条信道能给多个不同的接收器发送数据。

## OFDM：开挂式的频分复用
为了使频分复用中相邻子信道不互相干扰，通常两个子信道的带宽不会是相邻的，中间会留出一小段保护带宽。如果保护带宽设计过小，则起不到很好的保护作用，设计过大则会浪费通信带宽，降低通信速度。然而一种名为正交频分复用（OFDM）的技术可以完全不使用保护带宽，相反它故意让相邻的子信道的带宽重合，并且做到了信道之间不互相干扰。

## WiFi: 一种基于 OFDM 的无线通信技术
WiFi 就是一种使用了 OFDM 的通信技术，而在每个OFDM子载波上，使用调频加调相对数据进行调制。计算机中的二进制数据究竟如何通过 WiFi 发送的呢？计算机通信数据是串行的，WiFi网卡将串行的数据切成小块打包，将数据包交给所有子载波由并行传送。前面介绍调频和调相的时候说，可以将二进制的编码与频率、相位建立一一对应关系，给发射器一个怎样的二进制编码，它就生成对应相位或频率的波形。WiFi采用了一种更神奇的调制方法，比这种调频和调相方法更简单更快。WiFi对将要发送的一段二进制数据做逆傅里叶变换，然后所需的电磁波波形就直接生成了，逆傅里叶变换一次性完成了调频调相的全部工作。对高等数学较为熟悉的读者可能会很容易理解这一变换过程，为了避免占用过多篇幅，WiFi 中的傅里叶变换和逆傅里叶变换就单独拿出来讨论了。更严格地将，这里的逆傅里叶变换应成为快速离散逆傅里叶变换，快速是指针对特殊数据使用了一种更简单快速的计算方法，离散是指傅里叶变换的输入和输出都是若干个数而非连续的函数。这就表示快速逆傅里叶变换输出的波形是由一串采样值构成的，就好比电脑存储的声音文件记录的声音是声波的连续采样值一样。这段波形还不足以直接由天线发射出去，它频率太低，直接发送传播距离太近。于是WiFi 使用混频器将这段波形变成更高频率的波形。最终发射出去的WiFi电磁波频率达到了 2.4GHz， 另一种 WiFi 标准规定的频率为5GHz, 现在的手机和家用路由器都能够同时支持两种频率的WiFi了。5GHz的通信速率更快，但是穿墙能力会弱一些。

## 干扰不可避免，但 WiFi 可以修正


## 无所不能的 CSI

